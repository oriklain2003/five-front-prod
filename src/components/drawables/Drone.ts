import { Drawable, DrawableOptions } from './Drawable';

export interface DroneOptions extends DrawableOptions {
  rotation?: number;
}

export class Drone extends Drawable {
  private rotation: number;

  constructor(options: DroneOptions) {
    super(options);
    this.rotation = options.rotation || 0;
  }

  createSVG(): string {
    const size = (this.options.size ?? 20) * 1.3;
    const color = this.color;
    
    // Determine badge content
    let badge = '';
    const badgeCenterX = Drone.BADGE_SIZE_LARGE / 2;
    const badgeCenterY = Drone.BADGE_SIZE_LARGE / 2;
    if (this.classification?.suggested_identification) {
      // Has suggested classification - show !!
      badge = `
        <g transform="translate(1040, -10) rotate(-90, ${badgeCenterX}, ${badgeCenterY})">
          <rect x="0" y="0" width="${Drone.BADGE_SIZE_LARGE}" height="${Drone.BADGE_SIZE_LARGE}" 
            fill="#FF0000" rx="5"/>
          <text x="${badgeCenterX}" y="${badgeCenterY + 12}" 
            font-family="Arial, sans-serif" font-size="${Drone.BADGE_FONT_SIZE_LARGE}" 
            font-weight="bold" fill="#FFFFFF" text-anchor="middle">!!</text>
        </g>
      `;
    } else if (!this.classification || !this.classification.current_identification || this.classification.current_identification === 'unknownFast' || this.classification.current_identification === 'radarPoint') {
      // No classification or radar point - show !
      badge = `
        <g transform="translate(1040, -10) rotate(-90, ${badgeCenterX}, ${badgeCenterY})">
          <rect x="0" y="0" width="${Drone.BADGE_SIZE_LARGE}" height="${Drone.BADGE_SIZE_LARGE}" 
            fill="#FFA500" rx="5"/>
          <text x="${badgeCenterX}" y="${badgeCenterY + 12}" 
            font-family="Arial, sans-serif" font-size="${Drone.BADGE_FONT_SIZE_LARGE}" 
            font-weight="bold" fill="#FFFFFF" text-anchor="middle">!</text>
        </g>
      `;
    }
    const svg = `

</svg>

    `
    return `
    <svg width="${size}" height="${size}" viewBox="-150 400 1380 400" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: rotate(178.056deg);">
  <defs>
    <style>
      .drone-base { fill: #ff0000; opacity: 1; }
      .drone-light { fill: #ff4d4d; opacity: 1; }
      .drone-dark { fill: #b30000; opacity: 1; }
    </style>
  </defs>
  <path class="drone-dark" d="M-46.47,576.3c-20.43-1.4-40.99-2.58-61.46-4.04-6.17-.44-13.07,1.69-18.32-2.17l-.22-55.29c1.13-6.1,12.15-2.33,16.51-2.43,25.51-.6,51.38-3.04,76.95-4.11,148.75-6.23,297.43-11.6,446.09-17.94,28.08-1.2,56.33-2.84,84.46-4.02l.12-225.38c1.53-19.7,14.6-61.5,39.15-61.08,24.33.41,36.64,40.09,38.6,60.08l.12,226.38c28.1,1.04,56.37,2.81,84.46,4.02,149.01,6.38,298,11.73,447.09,17.94,25.22,1.05,50.77,3.52,75.95,4.11,4.36.1,15.39-3.68,16.51,2.43-.85,6.93,1.53,53.87-.99,56.01-2.91,2.48-13.38,1.21-17.58,1.48-20.39,1.35-41.03,2.59-61.43,4.01l-1.38-.31c.56-3.59.69-7.15.38-10.69-1.71,2.02-2.08,1.62-2-1-1.28.39-2.85.37-4,0-5.18.74-10.51,1.07-16,1-3.5.83-7.49.8-11,0-2,1.25-4.33,1.25-7,0-3.6.27-7.26.61-11,1-4.38,1.4-9.37,1.51-14,1-1.36,1.26-4.18,1.67-6,1-3.63,1-8.21.69-12,0,.11,1.63-2.65,1.47-4,1-2.91.31-5.91.65-9,1-2.76.18-5.76.18-9,0-2.26.27-4.6.6-7,1-2.82-.24-5.48-.24-8,0-3.03,1.02-7.26,1.56-10,0-1.01,1.82-4.91,1.42-7,1-2.14.72-4.47,1.06-7,1-2.91.51-5.57.51-8,0-2.58.32-5.24.66-8,1-3.23.05-6.57.05-10,0-4.48.77-9.15,1.1-14,1-3.41.89-7.53.72-11,0-.43,1.77-4.2,1.54-6,1-3.4.98-7.52.74-11,0-4.67,1.98-10,1.51-15,1-1.31,1.06-4.2,1.6-6,1-5.51.76-11.17,1.1-17,1-3.2.85-6.78.76-10,0l-.37,1.07c-2.71-.5-5.25-.53-7.63-.07-2.2.64-4.8.64-7,0-5.76,1.54-11.76,1.87-18,1-1.37,1.2-4.23,1.67-6,1-5.15.77-10.49,1.1-16,1-3.04.84-7.38,1.63-10,0-1.85.9-4.52,1.24-8,1-3.2.81-6.79.76-10,0-1.06.5-2.73.83-5,1-2.88.72-6.12.71-9,0-1.68,1.04-4.95,1.58-7,1-3.09.95-6.94.67-10,0-5.58,1.16-11.33,1.61-17,1-.98,1.3-4.26,1.61-6,1-3.05,1.01-6.86.73-10,0-4.71,2.08-10.82,1.55-16,1-1.85.81-4.14.78-6,0-4.21.27-8.54.6-13,1-4.47,1.48-9.47,1.81-15,1-.83,1.36-3.5,1.55-5,1-3.44.96-7.58.78-11,0-.9.74-2.57,1.07-5,1-3.21.82-6.79.79-10,0-2.61,1.59-5.34,1.45-8,0-3.6.28-7.27.61-11,1-4.21,1.45-9.43,1.58-14,1-1.8.88-4.14,1.22-7,1-4.37.7-8.84,1.01-13.41.93,1.39-.11,1.01.24-.59,1.07.88.19.85.52,0,1-1.06,5.2-.95,9.98.33,14.35l-1.33.65c-.07,30.62-.03,61.29.1,91.9,54.65,15.72,109.59,30.85,163.88,47.61,4.67,4.08.63,41.94-1.6,42.55l-170.44-10.63-14.94,54.56c16.02-.32,32,.62,48,1.01,1.78.63,1.45,1.29-1,2-11.23,1.43-31.34,4.89-41.62,4.9-2.43,0-5.38-1.83-5.9-1.78-1.55.16-3.95,11.97-5.27,14.58-2.19,4.32-7.12,8.09-9.72,12.3-8.98-6.57-13.65-17.04-15.52-27.97-13.93,1.22-28.91.06-42.96-1.03-2.18-1.15-.97-1.48,1-2,9.64-1.14,24.51-4.08,33.51-4.09,2.68,0,4.3.8,6.48,2.09l-13-55.01-171.41,11.06c-2.53-7.34-6.42-37.91-1.57-42.55,1.54-1.47,5.21-1.8,7.22-2.78l156.66-44.84c-.15-30.6.56-61.3.1-91.9l-1.34-.51c1.3-4.76,1.41-9.92.34-15.49-1.39,1.22-1.88.68-1-1-1.11.68-2.08.42-2-1-3.83.59-7.49.59-11,0-2.99.11-5.66-.23-8-1-4.2.62-9.16.38-13-1-4.7-.39-9.37-.72-14-1-1.92,1.23-3.97.95-6,0-2.27.74-4.77.89-7,0-4.08-.34-8.08-.68-12-1-1.7.74-4.26.87-6,0-1.76.79-5.09.03-7-1-5.96.68-12.24.85-18-1-.19.89-.52.85-1,0l-1.75,1.97c-.53-1.2-1.95-1.86-4.25-1.97-2.91.16-5.58-.18-8-1-3.1.71-6.91.76-10,0-5.18.09-10.18-.25-15-1-2.65.15-4.98-.18-7-1-4.82.65-10.32.28-15-1-3.78.76-7.44.76-11,0-2.07.61-5.33.13-7-1-2.88.69-6.12.72-9,0-3.3.26-5.97-.07-8-1-.19.89-.52.85-1,0-1.99.67-4.13,1.04-6,0-2.75-.38-5.41-.71-8-1-5.29.68-10.92.25-16-1-2.87.69-6.14.76-9,0-3,.11-5.66-.22-8-1-2.25.57-4.89.99-7,0-1.57.67-5.36.64-6-1-3.72-.45-7.39-.79-11-1-2.86,1.26-6.2,1.45-9,0-4.23.59-9.09.36-13-1-4.12-.45-8.12-.78-12-1-2.06,1.7-5.48.9-8,0-2.44.71-5.54.9-8,0-5.13.53-10.94,0-16-1-2.77.09-5.1-.24-7-1-6.35.99-12.35.66-18-1-.31,1.89-1.1,1.79-2,0-1.56.66-3.64.96-5,0-2.65.82-6.36-.05-9-1-2.23.71-4.8.81-7,0-2.03-.79-4.32-.88-6.36-.02l-.64-.98c-3.59.54-7.48,1.05-11,0-1.72.8-5.07-.05-7-1-2.88.68-6.13.74-9,0-3.16.06-6.16-.28-9-1-1.93.71-4.09.79-6,0-3.58.19-6.92-.14-10-1-2.06.74-4.91.9-7,0-2.61.85-6.54.56-9-1-.19.89-.52.85-1,0-1.91.63-4.29,1.03-6,0-1.96.55-5.52.27-7-1-2.9.78-6.18.8-9,0-2.41.04-4.41-.29-6-1-3.54.8-7.5.76-11,0-2.77.09-5.1-.24-7-1-3.31.5-6.64.5-10,0-5.45-.09-10.78-.42-16-1-1.84-.18-3.51.15-5,1,.85.24.83.58,0,1-1.31,2.59-1.63,5.78-.95,9.55l-1.05.45Z"></path>
  <path class="drone-base" d="M1013.53,571.3c.66,3.38,1.16,9.06,0,12-8.03.07-18.9,2.43-27.51,2.99-48.76,3.18-97.8,5.7-146.49,9.01-1.4-.42-.91-13.13-.47-13.7.17-.21,3.89-.91,4.47-.3,3.11-1.09,7.67-.79,11,0,1.38-.9,3.71-1.23,7-1,3.17-.82,6.81-.72,10,0,4.09-2.03,9.42-1.48,14-1,1.99-1.03,4.83-1.72,7-1,5.15-.77,10.49-1.11,16-1,3.13-.77,6.85-.72,10,0,1.9-.86,4.23-1.19,7-1,3.41-.89,7.53-.72,11,0,4.17-2.1,10.28-1.6,15-1l.37-1.11c2.64.54,5.19.58,7.63.11,2.21-.86,4.84-.78,7,0,2.45-.71,5.12-1.05,8-1,2.74-.46,5.4-.46,8,0,1.73-1.06,4.64-1.57,6,0,3.43-2.03,9.7-1.45,14-1,.85-.83,2.52-1.17,5-1,1.75-.91,4.26-.88,6,0Z"></path>
  <path class="drone-base" d="M726.22,538.5c11.75-3.58,13.35,11.25,5.6,13.6-9.47,2.88-12.36-11.54-5.6-13.6Z"></path>
  <path class="drone-light" d="M426.24,538.51c13.91-3.19,10.96,17.71-.46,13.02-6.05-2.48-5.77-11.59.46-13.02Z"></path>
  <path class="drone-light" d="M642.24,538.51c13.91-3.19,10.96,17.71-.46,13.02-6.05-2.48-5.77-11.59.46-13.02Z"></path>
  <path class="drone-light" d="M341.24,538.51c14.08-3.23,10.7,17.92-.46,13.03-5.58-2.44-5.93-11.56.46-13.03Z"></path>
        ${badge}
      </svg>
    `;
  }

  setRotation(rotation: number): void {
    this.rotation = rotation;
    if (this.marker) {
      const el = this.marker.getElement();
      const svg = el.querySelector('svg');
      if (svg) {
        svg.style.transform = `rotate(${rotation}deg)`;
      }
    }
  }

  update(options: Partial<import('./Drawable').DrawableOptions> & { rotation?: number }): void {
    super.update(options);
    
    // Update rotation if provided
    if (options.rotation !== undefined) {
      this.setRotation(options.rotation);
    }
    this.setRotation(this.rotation + 90);
  }
}

